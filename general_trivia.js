// const APIKEY = "63e531fa478852088da67f67";
// const APIKEY = "63ee3468478852088da68361"; //The demo one
const APIKEY = "63eed80f478852088da6838f"; //The demo two

/*Genshin Questions List*/

var list = `What is the relationship between Shenhe and Chongyun?(Aunt and Nephew(Sibings(Parent and Child(They aren't related
/Who is Alhaitham's roommate?(Kaveh(Nahida(Traveler(Cyno
/What is Mona's full name?(Mona Megistus(Astrologist Mona Megistus(Mona Narfidort(Mona Megistus The Second
/How does Oz address Fischl?(Mein Fraulein(M'Lady(Mistress(Your Highness
/What was the first name given to Wanderer?(Kabukimono(Scaramouche(Kunikuzushi(Makoto
/When did Kaeya recieve his Vision?(When fighting Diluc(When Crepus died(When Diluc got his Vision(When saving Diluc from monsters
/Which weapon is supposedly related to Razor?(Wolf's Gravestone(Rainslasher(Blackcliff Slasher(Favonius Greatsword
/What is the name of Klee's mother?(Alice(Lisa(Jean(Ningguang
/Which character is from Khaenri'ah?(Kaeya(Klee(Albedo(Alice
/Who is in Benny's Adventure Team?(Bennett(Bennett and Traveler(Bennett and Fischl(Bennett and Royce
/What does Sucrose have a collection of in her room?(Bones(Plants(Crystalflies(Books
/Who is the author of the novel 'A Legend of Sword'?(Xingqiu(Albedo(Chang the Ninth(Yae Miko
/Who is collaborating with Xingqiu to publish a book?(Albedo(No one(Yae Miko(Traveler
/Where did Tartaglia get his powers from?(The Abyss(The Fatui(With his Vision(He was born with them
/Who is Tartaglia's 'master'?(Skirk(Il Capitano(Tsaritsa(Pierro
/Which character shares the same birthday as Genshin's anniversary?(Ayaka(Bennett(Amber(Zhongli
/What does Ayato pull out of his sleeve during his idle?(Bubble Tea(Coffee(Dango Milk(A bottle of Sake
/Who is the Acting Grand Master of the Knights of Favonius?(Jean(Vanessa(Diluc(Varka
/Which aristocratic family does Eula belong to?(Lawrence(Ragnvindr(Gunnhildr(Rostova
/Which character does the constellation 'Serval' belong to?(Collei(Tighnari(Razor(Alhaitham
/Which of the following is the name of Beidou's C6?(Bane of Evil(Bane of All Evil(Bane of the Evils(Bane of the Deep
/What does Ganyu love snacking on?(Qingxin(Violetgrass(Glaze Lily(Silk Flowers
/Who does Keqing secretly look up to?(Rex Lapis(Ningguang(Traveler(Yun Jin
/Who is the General Mahamatra?(Cyno(Alhaitham(Tighnari(Candace
/Who is Beisht?(Osial's wife(Goddess of Salt(Azhdaha's Other Half(A Yaksha
/Why does Layla always appear drowsy?(She sleepwalks(She works very hard(She's a night owl(She thinks sleep is for the weak
/What was Tighnari's reason for wanting a Dendro Vision?(To reach high-hanging fruit(To move around sumeru most easily(For research(For power
/Who is the founder of the Yae Publishing House?(Yae Miko(Kokomi(Raiden Shogun(Miss Hina
/Who is Xiangling's mentor?(Madame Ping(Shenhe(Chef Mao(God of Stove
/Which of the following characters have the highest flat attack stat?(Xiao(Hu Tao(Cyno(Eula
/Which claymore character does not wield their weapon while dealing normal attacks?(Dori(Eula(Heizou(Sayu
/Which character does the soundtrack 'Time to Shine' belong to?(Arataki Itto(Hu Tao(Klee(Keqing
/Who is the featured 5 star in the banner 'Adrift in the Harbor'?(Ganyu(Mona(Nilou(Kokomi
/When did Khaenri'ah fall?(500 years ago(5000 years ago(400 years ago(1000 years ago
/What is the Cataclysm?(The Fall of Khaenri'ah(The Archon War(The Fall of King Deshret(When the Travelers fought the Unknown God
/How many Yakshas were considered the foremost Yakshas?(5(2(3(8
/Who is ranked first among the Eleven Fatui Harbingers?(Pierro(Il Dottore(Pulcinella(Columbina
/Who was the person who slayed Ursus the Drake?(Il Dottore(No one(Raiden Shogun(Rex Lapis
/Who is the maiden mentioned in the artifact set: Crimson Witch of Flames?(La Signora(Hu Tao(Alice(She does not exist
/Who is the current Grandmaster of the Knights of Favonius?(Varka(Jean(Diluc(Andrius
/Who is the first character to die on screen?(La Signora(Traveler's Sibling(Guizhong(No confirmed deaths so far
/What is Stormterror's true name?(Dvalin(Andrius(Durin(Duran
/Which organization is not part of the Tri-Commission?(Shogunate(Tenryou(Kanjou(Yashiro
/What is the name of the wine that Razor's parents left for him?(Thousand-Wind Wine(Dandelion Wine(Osmanthus Wine(Grey Valley Sunset Wine
/What is Baizhu's goal in taking care of Qiqi?(To find the secret to immortality(He treats Qiqi as his child(Qiqi can find herbs easier(To help with the shop
/How did Teppei die?(From using a Delusion(He was stabbed(He was getting sick(Old age
/Where is Eleazer found?(Sumeru(Inazuma(Liyue(Mondstadt
/Who is the first Aranara you meet?(Arana(Arama(Araima(Aramama
/Which is the blue Aranara?(Ararycan(Areama(Arama(Arenara
/Which Aranara sacrificed themselves?(Arama(Areama(Aramama(Arcinara
/How many of the original Seven still remain?(Two(All of them(None(Five
/Where was Old Mondstadt located?(Stormterror's Lair(Starfell Valley(Mappa Mare(Mare Jivari
/Who is the founder of the Knights of Favonius?(Vennessa(Varka(Crepus(Barbatos
/Which Harbinger was first introduced in 'A Winter Night's Lazzo'?(Columbina(Childe(Il Dottore(Arlecchino
/How many factions are there in Inazuma?(3(5(6(9
/How many playable characters are related to the Kamisato Clan?(4(3(2(5
/What is Fontaine's Ideal?(Justice(Eternity(Knowledge(Freedom
/Where did Oceanids originate from?(Fontaine(Mondstadt(Liyue(Enkanomiya
/Which region does 'Archon Quest Chapter III: Truth Amongst the Pages of Purana' take place in?(Sumeru(Liyue(Inazuma(Fontaine
/Who is the character that appears in 'Teyvat Chapter Storyline Preview: Travail, Snezhnaya Chapter'?(Pulcinella(Childe(Scaramouche(Il Dottore
/What flower does Lumine wear in her hair?(Inteyvat(Cecilia(Padisarah(Glaze Lily
/The Thunder Manifestation is a remnant of a late guardian of Tsurumi Island. What is the guardian's name?(Kanna Kapatcir(Thunder Manifestation(Metis(Eurynome
/What is Timmie's imaginary friend?(A Ruin Guard(He has none(Pigeons(A Ruin Drake
/What is the codename for the Sustainer of Heavenly Principles as noted in the game files?(Asmoday(Absinthe(Alice(Asbestos
/Where is the Adventurers' Guild's main headquarters located?(Snezhnaya(Mondstadt(Fontaine(Natlan
/What species inhabited Teyvat before humans?(Vishaps(Hilichurls(Archons(Other animals
/How many commisions are available daily?(4(2(5(10
/How many characters are playable as of Version 3.4?(62(75(68(67
/How many nations are explorable as of Version 3.4?(4(3(5(2
/What is the name of the standard wish banner?(Wanderlust Invocation(Beginner's Wish(Discerner of Enigmas(Tapestry of Gold
/Which character from the standard wish banner has their own banner?(Keqing(Mona(Diluc(Qiqi
/How much Genesis Crystals does a 5 star character outfit cost?(2480(1600(4230(5600
/What is the elemental reaction when Dendro meets Electro?(Catalyze(Quicken(Bloom(Burgeon
/Which of the following is a 5 star weapon?(Memory of Dust(Rust(Xiphos' Moonlight(Dark Iron Sword
/What is the main stat for 'Flower of Life'?(Flat HP(Flat ATK(Flat DEF(DEF%
/How many elements are there?(7(6(8(5
/What is the initial resin cap?(120(80(200(160
/What was the first co-op event?(Elemental Crucible(Windtrace(Unreconciled Stars(Theater Mechanicus
/Which element is most suitable to destory a Consecrated Red Vulture's Phagocytic Energy Block?(Pyro(Electro(Hydro(Cryo
/What happens after the infused form of an Eremite ends?(They enter a weakened state(They lose HP(They deal AOE damage(They call reinforcments
/What is the maximum number of companions you can put in the Serenitea Pot?(8(10(12(5
/How many realm layouts are available in the Serenitea Pot?(5(3(4(6
/Which character can refund materials when crafting furniture?(Yoimiya(Sayu(Albedo(Layla
/What is the max BP level?(50(55(45(48
/What are the ingredients needed for Sweet Madame?(2 Fowl + 2 Sweet Flower(2 Fowl + 1 Sweet Flower(3 Fowl + 1 Sweet Flower(2 Fowl + 3 Sugar
/Which of the following is a 5 star dish?(Adeptus' Temptation(Golden Fried Chicken(Bountiful Year(Milky Mushroom Crisp Tower
/What is the weapons inventory cap?(2000(3500(There is no cap(1800
/What is the maximum number of Condensed Resin that can you hold?(5(3(4(8
/What is the code name of the Electro Hypostasis?(Aleph(Beth(Dalet(Gimel
/Which region does the Boss Oceanid belong to?(Liyue(Fontaine(Mondstadt(It does not belong to a region
/What 4 Star weapon can you recieve for free in the base game?(Prototype Rancour(Toukabou Shigure(Sacrifical Sword(Dark Iron Sword
/Which boss has the voicelines: 'This opportunity is quite hard to come by.'?(Childe(Raiden Shogun(Scaramouche(La Signora
/What element or elements does Childe: Foul Legacy Transformation wield?(Electro + Hydro(Hydro(Electro(Cryo + Electro
/What effect does the Pyro element infused by Azhdaha produce?(Enhanced Attack Radius(Constant Damage per Second(Decreased Character Defense(Removes Character Elemental Energy
/What is the minimum crit damage needed to obtain the first 'Purveyor of Punishment' achievement?(5,000(100,000(10,000(50,000
/Which of the following weekly bosses cannot be done in co-op?(Stormterror(La Signora(Raiden Shogun(Childe
/What is the max reputation level in Inazuma?(10(8(20(18
/How many primogems do you get from Floors 9 to 12 for clearing the Spiral Abyss with 36 stars?(600(1000(800(540
/How many primogems can you obatin from daily commissions and claiming from Katheryne?(60(40(80(20
/How many locations can the Unusual Hilichurl appear?(14(9(7(16
`;

/*Tried to read the file -> Require not defined error*/

// const fs = require('fs'); /*To read the Character_Array file*/
// var path = "./Trivia/Character_Array.txt";

// var list;
// try{ /*Read the file*/
// list = fs.readFileSync(path, "UTF8");
// }catch{ /*Shows the text if it cannot read the file*/
//     console.log("Ohno")
// }

/*Randomise Characters*/
var specificchara = localStorage.getItem("chara"); /*Get random character*/
var specificimg = "";
var specificnum = "_4";

if (specificchara == 0) {
  specificimg = "Venti/Venti";
} else if (specificchara == 1) {
  specificimg = "Zhongli/Zhongli";
} else if (specificchara == 2) {
  specificimg = "Raiden/Raiden";
} else if (specificchara == 3) {
  specificimg = "Nahida/Nahida";
}

/*Display HP + DMG*/
var usernum;
let gettime = {
  async: true,
  crossDomain: true,
  // url: "https://ipaccountinfos-e395.restdb.io/rest/accounts",
  // url: "https://tempip-8a29.restdb.io/rest/accounts", //The demo one
  url: "https://temp2ip-d88b.restdb.io/rest/accounts", //The demo two
  method: "GET",
  headers: {
    "content-type": "application/json",
    "x-apikey": APIKEY,
    "cache-control": "no-cache",
  },
};

$.ajax(gettime).done(function (response) {
  for (var i = 0; i < response.length; i++) {
    /*Looks for the user's account*/
    if (response[i].email == username) {
      usernum = i; /*Gets the user's account position*/
      if (response[i].numwrong == 0) {
        console.log("4HP");
        specificnum = "_4";
        document.getElementById("CharaBlob").innerHTML =
          '<img src="./Artworks/' +
          specificimg +
          specificnum +
          'HP.png" id="MYCBlob" alt="oop" />';
      }
      if (response[i].numwrong == 1) {
        console.log("3HP");
        specificnum = "_3";
        document.getElementById("4thHP").innerHTML =
          '<img src="./Artworks/Other_Assets/Heart_Hollow.png" id="MYHP4" alt="oop" />';
        document.getElementById("CharaBlob").innerHTML =
          '<img src="./Artworks/' +
          specificimg +
          specificnum +
          'HP.png" id="MYCBlob" alt="oop" />';
      }
      if (response[i].numwrong == 2) {
        console.log("2HP");
        specificnum = "_2";
        document.getElementById("4thHP").innerHTML =
          '<img src="./Artworks/Other_Assets/Heart_Hollow.png" id="MYHP4" alt="oop" />';
        document.getElementById("3rdHP").innerHTML =
          '<img src="./Artworks/Other_Assets/Heart_Hollow.png" id="MYHP3" alt="oop" />';
        document.getElementById("CharaBlob").innerHTML =
          '<img src="./Artworks/' +
          specificimg +
          specificnum +
          'HP.png" id="MYCBlob" alt="oop" />';
      }
      if (response[i].numwrong == 3) {
        console.log("1HP");
        specificnum = "_1";
        document.getElementById("4thHP").innerHTML =
          '<img src="./Artworks/Other_Assets/Heart_Hollow.png" id="MYHP4" alt="oop" />';
        document.getElementById("3rdHP").innerHTML =
          '<img src="./Artworks/Other_Assets/Heart_Hollow.png" id="MYHP3" alt="oop" />';
        document.getElementById("2ndHP").innerHTML =
          '<img src="./Artworks/Other_Assets/Heart_Hollow.png" id="MYHP2" alt="oop" />';
        document.getElementById("CharaBlob").innerHTML =
          '<img src="./Artworks/' +
          specificimg +
          specificnum +
          'HP.png" id="MYCBlob" alt="oop" />';
      }
    }
  }
});

/*Start*/
var username = localStorage.getItem("username");
var qns = list.split("/"); /*Split the Questions*/

var qnnum = Math.floor(Math.random() * 100); /*Random question number*/
var qn;

for (var i = 0; i < qns.length; i++) {
  /*Calls the randomized question*/

  if (i == qnnum) {
    qn =
      qns[i].split("("); /*Splits the question into its questions and answers */
  }
}

document.getElementById("GTQuestion").innerHTML =
  qn[0]; /*Puts the Question in the Question Box*/

const nums = [1, 2, 3, 4];
const order = [];

for (var i = 0; i < 4; i++) {
  /*Randomize the order of Answers*/
  var opt = Math.floor(Math.random() * nums.length); /*Random Answer Location*/
  order.push(nums[opt]); /*Adds the number from nums into order*/
  nums.splice(opt, 1); /*Removes the number from nums*/
}

for (var i = 0; i < 4; i++) {
  /*To place the answers*/
  var optname = "MYGTopt" + (i + 1);
  document.getElementById(optname).innerHTML = qn[order[i]];
}

var correct;
for (var i = 1; i <= 4; i++) {
  /*If the answer is the same as the correct answer in the List*/
  if (document.getElementById("MYGTopt" + i).innerHTML == qn[1]) {
    correct = i; /*Let correct be the correct position number*/
  }
}

/*30 Second GTCountdown for Questions*/
var seconds = 30;
var cd = document.getElementById("GTCountdown");

var timer = setInterval(countdown, 1000);

function countdown() {
  if (seconds == -1) {
    clearInterval(timer);
    checkbuttonid(5);
  } else {
    cd.innerHTML = seconds + " seconds";
    seconds--;
  }
}

/*If the button is pressed:*/
document.getElementById("MYGTopt1").onclick = () => {
  checkbuttonid(1);
};
document.getElementById("MYGTopt2").onclick = () => {
  checkbuttonid(2);
};
document.getElementById("MYGTopt3").onclick = () => {
  checkbuttonid(3);
};
document.getElementById("MYGTopt4").onclick = () => {
  checkbuttonid(4);
};

function checkbuttonid(id) {
  if (id == correct) {
    /*When the correct option is clicked*/
    alert("The Answer is correct!");
    var usernum;
    let gettime = {
      async: true,
      crossDomain: true,
      // url: "https://ipaccountinfos-e395.restdb.io/rest/accounts",
      // url: "https://tempip-8a29.restdb.io/rest/accounts", //The demo one
      url: "https://temp2ip-d88b.restdb.io/rest/accounts", //The demo two
      method: "GET",
      headers: {
        "content-type": "application/json",
        "x-apikey": APIKEY,
        "cache-control": "no-cache",
      },
    };

    $.ajax(gettime).done(function (response) {
      for (var i = 0; i < response.length; i++) {
        /*Looks for the user's account*/
        var username = localStorage.getItem("username");
        if (response[i].email == username) {
          usernum = i; /*Gets the user's account position*/
          if (response[i].gtnumtrydone >= 4) {
            /*If it is the last try, bring back to homepage and deny entry*/
            alert("You have completed all your tries for today!");
            document.getElementById("MYanimation").innerHTML =
              '<lottie-player src="https://assets8.lottiefiles.com/packages/lf20_gbfwtkzw.json" background="#3E3C46" speed="1.5" style="position: fixed; z-index: 5; width: 100vw; height: 100vh; overflow: hidden" loop autoplay></lottie-player>';
            setTimeout(myURL, 5000);
            function myURL() {
              window.location.href = "http://127.0.0.1:5500/win.html";
            }
            var updatelasttry = new Date();
            var tries = response[i].gtnumtrydone;
            tries += 1;

            var jsondata = {
              email: username,
              password: response[i].password,
              gttryagain: updatelasttry,
              gtnumtrydone: tries,
            };

            var puttime = {
              async: true,
              crossDomain: true,
              // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
              // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
              url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
              method: "PUT",
              headers: {
                "content-type": "application/json",
                "x-apikey": APIKEY,
                "cache-control": "no-cache",
              },
              processData: false,
              data: JSON.stringify(jsondata),
            };

            $.ajax(puttime).done(function (response) {});
          } else if (4 > response[i].gtnumtrydone >= 0) {
            /*If the user has done/started the General Trivia today, update gttry5date, compare gttry1date and gttry5date*/
            document.getElementById("MYanimation").innerHTML =
              '<lottie-player src="https://assets8.lottiefiles.com/packages/lf20_gbfwtkzw.json" background="#3E3C46" speed="1.5" style="position: fixed; z-index: 5; width: 100vw; height: 100vh; overflow: hidden" loop autoplay></lottie-player>';
            setTimeout(myURL, 5000);
            function myURL() {
              window.location.reload(true);
            }
            var updatelasttry = new Date();

            var jsondata = {
              email: username,
              password: response[i].password,
              gttry5date: updatelasttry,
            };

            var puttime = {
              async: true,
              crossDomain: true,
              // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
              // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
              url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
              method: "PUT",
              headers: {
                "content-type": "application/json",
                "x-apikey": APIKEY,
                "cache-control": "no-cache",
              },
              processData: false,
              data: JSON.stringify(jsondata),
            };

            $.ajax(puttime).done(function (response) {
              console.log("Less than 4 tries");
            });

            if (
              new Date(response[i].gttry1date).toDateString() ==
              updatelasttry.toDateString()
            ) {
              /*If questions were answered on the same day, continue adding to the 5 question limit counter (gtnumtrydone)*/
              var tries = response[i].gtnumtrydone;
              tries += 1;

              var jsondata = {
                email: username,
                password: response[i].password,
                gtnumtrydone: tries,
              };

              var puttime = {
                async: true,
                crossDomain: true,
                // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
                // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
                url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
                method: "PUT",
                headers: {
                  "content-type": "application/json",
                  "x-apikey": APIKEY,
                  "cache-control": "no-cache",
                },
                processData: false,
                data: JSON.stringify(jsondata),
              };

              $.ajax(puttime).done(function (response) {
                console.log("Same Day");
              });
            } else if (
              new Date(response[i].gttry1date).toDateString() !=
              updatelasttry.toDateString()
            ) {
              /*If questions were answered on different days, update gttry1date, gttry5date and reset 5 question limit counter to 1 (gtnumtrydone)*/
              alert(
                "The day has been reset, the previous question will be counted as one of your tries for today!"
              );
              var jsondata = {
                email: username,
                password: response[i].password,
                gttry1date: updatelasttry,
                gtnumtrydone: 1,
              };

              var puttime = {
                async: true,
                crossDomain: true,
                // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
                // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
                url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
                method: "PUT",
                headers: {
                  "content-type": "application/json",
                  "x-apikey": APIKEY,
                  "cache-control": "no-cache",
                },
                processData: false,
                data: JSON.stringify(jsondata),
              };

              $.ajax(puttime).done(function (response) {
                console.log("Different Day");
              });
            }
          }
        }
      }
    });
  } else if (id != correct) {
    /*If the clicked buttons is not the correct answer*/
    if (id != 5) {
      alert("The Answer is incorrect!");
      clearInterval(timer);
    }
    if (id == 5) {
      alert("Time is up!");
    }
    var usernum;
    let gettime = {
      async: true,
      crossDomain: true,
      // url: "https://ipaccountinfos-e395.restdb.io/rest/accounts",
      // url: "https://tempip-8a29.restdb.io/rest/accounts", //The demo one
      url: "https://temp2ip-d88b.restdb.io/rest/accounts", //The demo two
      method: "GET",
      headers: {
        "content-type": "application/json",
        "x-apikey": APIKEY,
        "cache-control": "no-cache",
      },
    };

    $.ajax(gettime).done(function (response) {
      alert("You've lost 1 HP!");
      for (var i = 0; i < response.length; i++) {
        /*Looks for the user's account*/
        var username = localStorage.getItem("username");
        if (response[i].email == username) {
          usernum = i; /*Gets the user's account position*/
          if (response[i].numwrong >= 3) {
            /*If out of HP*/
            alert("You've run out of HP!");
            document.getElementById("MYanimation").innerHTML =
              '<lottie-player src="https://assets8.lottiefiles.com/packages/lf20_gbfwtkzw.json" background="#3E3C46" speed="1.5" style="position: fixed; z-index: 5; width: 100vw; height: 100vh; overflow: hidden" loop autoplay></lottie-player>';
            setTimeout(myURL, 5000);
            function myURL() {
              window.location.href = "http://127.0.0.1:5500/lose.html";
            }
            var wrong = response[i].numwrong;
            var tries = 5;
            wrong += 1;

            var jsondata = {
              email: username,
              password: response[i].password,
              gttryagain: updatelasttry,
              gtnumtrydone: tries,
              numwrong: wrong,
            };

            var puttime = {
              async: true,
              crossDomain: true,
              // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
              // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
              url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
              method: "PUT",
              headers: {
                "content-type": "application/json",
                "x-apikey": APIKEY,
                "cache-control": "no-cache",
              },
              processData: false,
              data: JSON.stringify(jsondata),
            };

            $.ajax(puttime).done(function (response) {});
          } else if (response[i].gtnumtrydone >= 4) {
            /*If it is the last try, bring back to homepage and deny entry*/
            alert("You have completed all your tries for today!");
            document.getElementById("MYanimation").innerHTML =
              '<lottie-player src="https://assets8.lottiefiles.com/packages/lf20_gbfwtkzw.json" background="#3E3C46" speed="1.5" style="position: fixed; z-index: 5; width: 100vw; height: 100vh; overflow: hidden" loop autoplay></lottie-player>';
            setTimeout(myURL, 5000);
            function myURL() {
              window.location.href = "http://127.0.0.1:5500/win.html";
            }
            var updatelasttry = new Date();
            var tries = response[i].gtnumtrydone;
            var wrong = response[i].numwrong;
            wrong += 1;
            tries += 1;

            var jsondata = {
              email: username,
              password: response[i].password,
              gttryagain: updatelasttry,
              gtnumtrydone: tries,
              numwrong: wrong,
            };

            var puttime = {
              async: true,
              crossDomain: true,
              // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
              // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
              url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
              method: "PUT",
              headers: {
                "content-type": "application/json",
                "x-apikey": APIKEY,
                "cache-control": "no-cache",
              },
              processData: false,
              data: JSON.stringify(jsondata),
            };

            $.ajax(puttime).done(function (response) {});
          } else if (4 > response[i].gtnumtrydone >= 0) {
            /*If the user has done/started the General Trivia today, update gttry5date, compare gttry1date and gttry5date*/
            document.getElementById("MYanimation").innerHTML =
              '<lottie-player src="https://assets8.lottiefiles.com/packages/lf20_gbfwtkzw.json" background="#3E3C46" speed="1.5" style="position: fixed; z-index: 5; width: 100vw; height: 100vh; overflow: hidden" loop autoplay></lottie-player>';
            setTimeout(myURL, 5000);
            function myURL() {
              window.location.reload(true);
            }
            var updatelasttry = new Date();
            var wrong = response[i].numwrong;
            wrong += 1;

            var jsondata = {
              email: username,
              password: response[i].password,
              gttry5date: updatelasttry,
              numwrong: wrong,
            };

            var puttime = {
              async: true,
              crossDomain: true,
              // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
              // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
              url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
              method: "PUT",
              headers: {
                "content-type": "application/json",
                "x-apikey": APIKEY,
                "cache-control": "no-cache",
              },
              processData: false,
              data: JSON.stringify(jsondata),
            };

            $.ajax(puttime).done(function (response) {
              console.log("Less than 5 tries");
            });

            if (
              new Date(response[i].gttry1date).toDateString() ==
              updatelasttry.toDateString()
            ) {
              /*If questions were answered on the same day, continue adding to the 5 question limit counter (gtnumtrydone)*/
              var tries = response[i].gtnumtrydone;
              tries += 1;

              var jsondata = {
                email: username,
                password: response[i].password,
                gtnumtrydone: tries,
              };

              var puttime = {
                async: true,
                crossDomain: true,
                // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
                // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
                url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
                method: "PUT",
                headers: {
                  "content-type": "application/json",
                  "x-apikey": APIKEY,
                  "cache-control": "no-cache",
                },
                processData: false,
                data: JSON.stringify(jsondata),
              };

              $.ajax(puttime).done(function (response) {
                console.log("Same Day");
              });
            } else if (
              new Date(response[i].gttry1date).toDateString() !=
              updatelasttry.toDateString()
            ) {
              /*If questions were answered on different days, update gttry1date, gttry5date and reset 5 question limit counter to 1 (gtnumtrydone)*/
              alert(
                "The day has been reset, the previous question will be counted as one of your tries for today and your previous questions' rewards will be removed!"
              );
              var jsondata = {
                email: username,
                password: response[i].password,
                gttry1date: updatelasttry,
                gtnumtrydone: 1,
                numwrong: 1,
              };

              var puttime = {
                async: true,
                crossDomain: true,
                // url: `https://ipaccountinfos-e395.restdb.io/rest/accounts/${response[i]._id}`,
                // url: `https://tempip-8a29.restdb.io/rest/accounts/${response[i]._id}`, //The demo one
                url: `https://temp2ip-d88b.restdb.io/rest/accounts/${response[i]._id}`, //The demo two
                method: "PUT",
                headers: {
                  "content-type": "application/json",
                  "x-apikey": APIKEY,
                  "cache-control": "no-cache",
                },
                processData: false,
                data: JSON.stringify(jsondata),
              };

              $.ajax(puttime).done(function (response) {
                console.log("Different Day");
              });
            }
          }
        }
      }
    });
  }
}
// localStorage.clear(); /*To clear the questions for testing*/
